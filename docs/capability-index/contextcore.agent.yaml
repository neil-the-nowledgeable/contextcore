manifest_id: contextcore.agent
name: ContextCore Agent Capabilities
version: 1.14.0
description: 'Agent-focused capabilities for ContextCore SDK.

  Tasks as OTel spans, insights as knowledge, handoffs as coordination.

  A2A protocol interoperability for cross-framework agent communication.

  '
owner: force-multiplier-labs
repository: https://github.com/Force-Multiplier-Labs/contextcore
labels:
  domain: observability
  tier: sdk
  audience: agent
manifest_tokens: 400
index_tokens: 2500
capabilities:
- capability_id: contextcore.insight.emit
  category: action
  maturity: stable
  summary: Emit agent-generated insights as OTel spans for cross-agent collaboration
  audiences:
  - agent
  - human
  description:
    agent: 'Emit insight span. In: {type: enum[analysis|decision|blocker|discovery|lesson|risk|progress], summary: string,
      confidence: float[0-1], audience: enum[agent|human|both], rationale?: string, evidence?: Evidence[], applies_to?: string[],
      category?: string}. Out: Insight with trace_id. Span stored in Tempo, queryable via TraceQL.

      '
    human: 'Persists agent-generated knowledge as OpenTelemetry spans in Tempo. Supports

      multiple insight types (decisions, blockers, lessons, etc.) with confidence

      scoring and evidence linking. Insights are queryable by other agents and

      visible in Grafana dashboards. Supports file-path scoping via `applies_to`

      for context-specific lessons.

      '
  triggers:
  - emit insight
  - record decision
  - log blocker
  - save lesson
  - agent knowledge
  inputs:
    type: object
    required:
    - insight_type
    - summary
    - confidence
    properties:
      insight_type:
        type: string
        enum:
        - analysis
        - recommendation
        - decision
        - question
        - blocker
        - discovery
        - risk
        - progress
        - lesson
      summary:
        type: string
        description: Brief description of the insight
      confidence:
        type: number
        minimum: 0.0
        maximum: 1.0
      audience:
        type: string
        enum:
        - agent
        - human
        - both
        default: both
      rationale:
        type: string
        description: Explanation supporting the insight
      evidence:
        type: array
        items:
          type: object
          properties:
            type:
              type: string
            ref:
              type: string
            description:
              type: string
      applies_to:
        type: array
        items:
          type: string
        description: File paths or patterns this insight applies to
      category:
        type: string
        description: Categorization for lessons (e.g., testing, architecture)
  outputs:
    type: object
    properties:
      id:
        type: string
      trace_id:
        type: string
      timestamp:
        type: string
        format: datetime
  evidence:
  - type: code
    ref: src/contextcore/agent/insights.py
    description: InsightEmitter class with emit() method (lines 85-200)
  - type: code
    ref: src/contextcore/agent/insights.py
    description: InsightType enum defining all insight categories (lines 33-43)
  - type: test
    ref: tests/agent/test_insights.py
    description: Unit tests for insight emission
  confidence: 0.95
  anti_patterns:
  - Never emit insights without confidence scores—they're required for prioritization
  - Don't use audience=agent for blockers humans need to see
  traceql_examples:
  - query: '{ span.insight.type = "decision" && span.insight.confidence > 0.8 }'
    description: Find high-confidence decisions
  - query: '{ span.insight.type = "blocker" && resource.project.id = "myproject" }'
    description: Find blockers for a specific project
  discovery_paths:
  - If you need to persist knowledge that survives across sessions, emit insights as spans.
  - If you want other agents to benefit from your discoveries, emit decisions and lessons.
- capability_id: contextcore.insight.query
  category: query
  maturity: stable
  summary: Query prior insights from Tempo by project, type, confidence, or file path
  audiences:
  - agent
  - human
  description:
    agent: 'Query insights from Tempo. In: {project_id: string, insight_type?: enum, min_confidence?: float, time_range?:
      string, applies_to?: string, limit?: int}. Out: Insight[]. Uses TraceQL internally. get_blockers() returns unresolved
      blockers.

      '
    human: 'Retrieves previously emitted insights from Tempo using TraceQL queries.

      Supports filtering by project, insight type, confidence threshold, time

      range, and file path scope. The `get_blockers()` method specifically

      retrieves unresolved blocker insights for a project.

      '
  triggers:
  - query insights
  - get decisions
  - find blockers
  - search lessons
  - prior knowledge
  inputs:
    type: object
    required:
    - project_id
    properties:
      project_id:
        type: string
      insight_type:
        type: string
        enum:
        - analysis
        - recommendation
        - decision
        - question
        - blocker
        - discovery
        - risk
        - progress
        - lesson
      min_confidence:
        type: number
        minimum: 0.0
        maximum: 1.0
      time_range:
        type: string
        description: Duration string (e.g., "24h", "7d")
      applies_to:
        type: string
        description: Filter by file path or pattern
      limit:
        type: integer
        default: 50
  outputs:
    type: array
    items:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        summary:
          type: string
        confidence:
          type: number
        timestamp:
          type: string
        evidence:
          type: array
  evidence:
  - type: code
    ref: src/contextcore/agent/insights.py
    description: InsightQuerier class with query() method (lines 397-876)
  - type: code
    ref: src/contextcore/agent/insights.py
    description: get_blockers() method for unresolved blockers (lines 878-883)
  - type: test
    ref: tests/agent/test_insights.py
    description: Query tests with various filters
  confidence: 0.9
  traceql_examples:
  - query: '{ span.insight.type = "lesson" && span.insight.applies_to =~ ".*test.*" }'
    description: Find lessons about testing
  - query: '{ span.insight.confidence >= 0.9 } | select(span.insight.summary)'
    description: Get summaries of high-confidence insights
- capability_id: contextcore.handoff.initiate
  category: action
  maturity: beta
  summary: Start agent-to-agent task delegation with size constraints and expected output
  audiences:
  - agent
  - human
  description:
    agent: 'Create handoff to another agent. In: {to_agent: string, capability_id: string, task: string, inputs: object, expected_output:
      {type: string, fields: string[], max_lines?: int, max_tokens?: int, completeness_markers?: string[]}, priority?: enum[critical|high|normal|low],
      timeout_ms?: int}. Out: HandoffResult with status, result_trace_id. Stored in K8s CRD or file storage.

      '
    human: 'Initiates structured task delegation between agents. The requesting agent

      specifies what capability is needed, inputs, and expected output format

      including size constraints (max_lines, max_tokens). Supports priority levels

      and timeout configuration. Uses pluggable storage (K8s CRD or file-based).

      '
  triggers:
  - handoff to
  - delegate task
  - agent coordination
  - request capability
  - stage output contract
  - pipeline stage handoff
  - typed stage output
  inputs:
    type: object
    required:
    - to_agent
    - capability_id
    - task
    - inputs
    - expected_output
    properties:
      to_agent:
        type: string
        description: Target agent identifier
      capability_id:
        type: string
        description: Capability being requested (e.g., "investigate_error")
      task:
        type: string
        description: Task description
      inputs:
        type: object
        description: Input data for the task
      expected_output:
        type: object
        required:
        - type
        - fields
        properties:
          type:
            type: string
          fields:
            type: array
            items:
              type: string
          max_lines:
            type: integer
          max_tokens:
            type: integer
          completeness_markers:
            type: array
            items:
              type: string
      priority:
        type: string
        enum:
        - critical
        - high
        - normal
        - low
        default: normal
      timeout_ms:
        type: integer
        default: 300000
  outputs:
    type: object
    properties:
      handoff_id:
        type: string
      status:
        type: string
        enum:
        - pending
        - accepted
        - in_progress
        - input_required
        - completed
        - failed
        - timeout
        - cancelled
        - rejected
        description: Full A2A-aligned state machine with is_terminal(), is_active(), can_transition_to() helpers
      result_trace_id:
        type: string
      error_message:
        type: string
  evidence:
  - type: code
    ref: src/contextcore/agent/handoff.py
    description: HandoffManager class with create_and_await() method
  - type: code
    ref: src/contextcore/agent/handoff.py
    description: HandoffStatus enum with 9 states, is_terminal(), is_active(), can_transition_to()
  - type: code
    ref: src/contextcore/agent/handoff.py
    description: ExpectedOutput dataclass with size constraints
  - type: test
    ref: tests/agent/test_handoff.py
    description: Handoff lifecycle tests
  confidence: 0.85
  risk_flags:
  - risk:k8s-restart-loses-in-flight
  anti_patterns:
  - Don't set max_lines > 150 for LLM-generated code—truncation risk
  - Always specify completeness_markers for code generation
  discovery_paths:
  - If you need to define what a pipeline stage should produce, use ExpectedOutput via this capability.
  - If you need typed agent-to-agent delegation with provenance tracking, start here.
- capability_id: contextcore.handoff.receive
  category: action
  maturity: beta
  summary: Poll for and process incoming handoffs as receiving agent
  audiences:
  - agent
  - human
  description:
    agent: 'Poll pending handoffs. In: {project_id: string, poll_interval_s?: float, timeout_s?: float}. Yields: Handoff.
      Call complete(handoff_id, result_trace_id) or fail(handoff_id, error). Supports graceful shutdown.

      '
    human: 'Enables agents to receive and process delegated tasks from other agents.

      Uses polling pattern with configurable interval. Receiving agent must

      call complete() or fail() to update handoff status. Supports graceful

      shutdown via context manager or shutdown() method.

      '
  triggers:
  - receive handoff
  - poll for tasks
  - accept delegation
  - process handoff
  - stage input validation
  - pipeline stage input
  inputs:
    type: object
    required:
    - project_id
    properties:
      project_id:
        type: string
      poll_interval_s:
        type: number
        default: 1.0
      timeout_s:
        type: number
        description: Max time to poll before returning
  outputs:
    type: object
    description: Handoff object when available
    properties:
      id:
        type: string
      from_agent:
        type: string
      to_agent:
        type: string
      capability_id:
        type: string
      task:
        type: string
      inputs:
        type: object
      expected_output:
        type: object
  evidence:
  - type: code
    ref: src/contextcore/agent/handoff.py
    description: HandoffReceiver class with poll_handoffs() method (lines 353-470)
  confidence: 0.8
- capability_id: contextcore.guidance.read_constraints
  category: query
  maturity: beta
  summary: Read human-defined constraints from ProjectContext CRD
  audiences:
  - agent
  - human
  description:
    agent: 'Get constraints. In: {project_id: string, path?: string}. Out: Constraint[] with {id, rule, scope, severity: enum[blocking|warning|advisory],
      reason}. Use get_constraints_for_path() to filter by file. BLOCKING constraints must be obeyed.

      '
    human: 'Retrieves human-defined constraints from the ProjectContext Kubernetes CRD.

      Constraints define what agents must NOT do, with severity levels (blocking,

      warning, advisory). The `get_constraints_for_path()` method filters constraints

      relevant to a specific file path or scope pattern.

      '
  triggers:
  - read constraints
  - check rules
  - human guidance
  - project constraints
  inputs:
    type: object
    required:
    - project_id
    properties:
      project_id:
        type: string
      path:
        type: string
        description: Optional file path to filter constraints
  outputs:
    type: array
    items:
      type: object
      properties:
        id:
          type: string
        rule:
          type: string
        scope:
          type: string
        severity:
          type: string
          enum:
          - blocking
          - warning
          - advisory
        reason:
          type: string
  evidence:
  - type: code
    ref: src/contextcore/agent/guidance.py
    description: GuidanceReader class with get_constraints_for_path() (lines 96-280)
  - type: code
    ref: src/contextcore/agent/guidance.py
    description: Constraint dataclass with severity enum (lines 51-57)
  confidence: 0.85
  anti_patterns:
  - Never ignore BLOCKING constraints—they are mandatory
- capability_id: contextcore.guidance.answer_question
  category: action
  maturity: beta
  summary: Answer open questions from humans with confidence and evidence
  audiences:
  - agent
  - human
  description:
    agent: 'Answer question. In: {question_id: string, answer: string, confidence: float[0-1], evidence?: Evidence[]}. Updates
      question status to "answered" in ProjectContext CRD. Also emits insight span for persistence.

      '
    human: 'Enables agents to answer questions posed by humans in the ProjectContext CRD.

      Updates the question status to "answered" and emits an insight span containing

      the answer with confidence and evidence. This creates a persistent, queryable

      record of agent answers.

      '
  triggers:
  - answer question
  - respond to human
  - provide answer
  inputs:
    type: object
    required:
    - question_id
    - answer
    - confidence
    properties:
      question_id:
        type: string
      answer:
        type: string
      confidence:
        type: number
        minimum: 0.0
        maximum: 1.0
      evidence:
        type: array
        items:
          type: object
          properties:
            type:
              type: string
            ref:
              type: string
  outputs:
    type: object
    properties:
      success:
        type: boolean
      insight_id:
        type: string
  evidence:
  - type: code
    ref: src/contextcore/agent/guidance.py
    description: GuidanceResponder.answer_question() method (lines 310-426)
  confidence: 0.85
- capability_id: contextcore.code_generation.contract
  category: action
  maturity: beta
  summary: Define code generation contracts with size limits and completeness markers
  audiences:
  - agent
  - human
  description:
    agent: 'Request code generation with contract. In: {to_agent: string, spec: {target_file: string, description: string,
      max_lines: int=150, max_tokens?: int, required_exports: string[], context_files?: string[], allows_decomposition: bool=true}}.
      Pre-flight validation estimates size. If estimate > limit, decomposition negotiated via span events.

      '
    human: 'Specialized handoff for code generation with proactive truncation prevention.

      The requesting agent specifies size constraints (max_lines, max_tokens) and

      required exports. The receiving agent estimates output size BEFORE generation

      and triggers decomposition if limits would be exceeded. All decisions are

      recorded as OTel spans.

      '
  triggers:
  - generate code
  - code contract
  - size-limited generation
  - truncation prevention
  - pipeline output contract
  - generation size limit
  inputs:
    type: object
    required:
    - to_agent
    - spec
    properties:
      to_agent:
        type: string
      spec:
        type: object
        required:
        - target_file
        - description
        properties:
          target_file:
            type: string
          description:
            type: string
          max_lines:
            type: integer
            default: 150
          max_tokens:
            type: integer
          required_exports:
            type: array
            items:
              type: string
          context_files:
            type: array
            items:
              type: string
          allows_decomposition:
            type: boolean
            default: true
  outputs:
    type: object
    properties:
      result:
        type: string
        enum:
        - generated
        - decomposed
        - rejected
      trace_id:
        type: string
      chunks:
        type: array
        items:
          type: string
  evidence:
  - type: code
    ref: src/contextcore/agent/code_generation.py
    description: CodeGenerationHandoff class with request_code() (lines 1-100)
  - type: code
    ref: src/contextcore/agent/code_generation.py
    description: CodeGenerationSpec dataclass (lines 77-100)
  confidence: 0.8
  anti_patterns:
  - Never skip size estimation—truncated code is worse than no code
  - Always specify required_exports for verification
- capability_id: contextcore.size_estimation.estimate
  category: query
  maturity: beta
  summary: Estimate code output size before generation using heuristics
  audiences:
  - agent
  - human
  description:
    agent: 'Estimate output size. In: {task: string, inputs?: {required_exports?: string[], context_files?: string[]}}. Out:
      {lines: int, tokens: int, complexity: enum[low|medium|high], confidence: float, reasoning: string}. Uses keyword patterns
      and construct detection.

      '
    human: 'Provides heuristics-based estimation of code output size before generation.

      Analyzes task description for complexity keywords and counts expected

      constructs (classes, methods, functions). Returns line/token estimates

      with confidence scoring. Used by code_generation.contract for pre-flight

      validation.

      '
  triggers:
  - estimate size
  - predict lines
  - output size
  - before generation
  inputs:
    type: object
    required:
    - task
    properties:
      task:
        type: string
        description: Task description to analyze
      inputs:
        type: object
        properties:
          required_exports:
            type: array
            items:
              type: string
          context_files:
            type: array
            items:
              type: string
  outputs:
    type: object
    properties:
      lines:
        type: integer
      tokens:
        type: integer
      complexity:
        type: string
        enum:
        - low
        - medium
        - high
      confidence:
        type: number
      reasoning:
        type: string
  evidence:
  - type: code
    ref: src/contextcore/agent/size_estimation.py
    description: SizeEstimator class with estimate() method (lines 50-100)
  - type: code
    ref: src/contextcore/agent/size_estimation.py
    description: Heuristic constants and keyword patterns (lines 61-96)
  confidence: 0.75
- capability_id: contextcore.a2a.server
  category: integration
  maturity: beta
  summary: Expose ContextCore agent as A2A-compatible server with JSON-RPC and discovery
  audiences:
  - agent
  - human
  description:
    agent: 'A2A server. create_a2a_server(agent_id, agent_name, base_url, project_id) → A2AServer. Endpoints: GET /.well-known/agent.json
      (AgentCard), POST /a2a (JSON-RPC 2.0), GET /health. Methods: message.send, tasks.get, tasks.list, tasks.cancel, agent.getExtendedAgentCard.
      Supports Flask and FastAPI.

      '
    human: 'Exposes a ContextCore agent as an A2A-compatible server. External A2A agents

      can discover the agent via .well-known/agent.json, send messages via JSON-RPC 2.0,

      and track task status. Supports both Flask and FastAPI frameworks with automatic

      fallback. Incoming A2A messages are converted to ContextCore handoffs via TaskAdapter.

      '
  triggers:
  - a2a server
  - agent server
  - agent discovery
  - json-rpc endpoint
  - well-known agent
  inputs:
    type: object
    required:
    - agent_id
    - agent_name
    - base_url
    - project_id
    properties:
      agent_id:
        type: string
        description: Unique identifier for the agent
      agent_name:
        type: string
        description: Human-readable agent name
      base_url:
        type: string
        description: Base URL for the server
      project_id:
        type: string
        description: Project identifier for handoff routing
      host:
        type: string
        default: 0.0.0.0
      port:
        type: integer
        default: 8080
      framework:
        type: string
        enum:
        - flask
        - fastapi
        default: flask
  outputs:
    type: object
    properties:
      server:
        type: object
        description: A2AServer instance
  evidence:
  - type: code
    ref: src/contextcore/agent/a2a_server.py
    description: A2AServer class with Flask/FastAPI app creation and discovery endpoints
  - type: code
    ref: src/contextcore/agent/a2a_messagehandler.py
    description: A2AMessageHandler routing JSON-RPC methods to HandoffsAPI/SkillsAPI
  - type: code
    ref: src/contextcore/discovery/endpoint.py
    description: DiscoveryEndpoint serving .well-known/agent.json
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: Protocol 7 A2A Interoperability documentation
  confidence: 0.8
  anti_patterns:
  - Don't expose A2A server without authentication in production
- capability_id: contextcore.a2a.client
  category: integration
  maturity: beta
  summary: Communicate with remote A2A-compatible agents via JSON-RPC client
  audiences:
  - agent
  - human
  description:
    agent: 'A2A client. A2AClient(base_url, auth?, timeout_seconds?) as context manager. Methods: send_text(text) → dict,
      send_message(Message) → dict, get_task(task_id) → dict, send_and_await(Message, timeout_ms?, poll_interval_ms?) → Handoff,
      get_agent_card() → AgentCard. Uses httpx.

      '
    human: 'Client for communicating with any A2A-compatible agent. Supports agent card

      discovery, message sending, task status polling, and synchronous send-and-await

      pattern. Converts A2A Task responses to ContextCore Handoff objects via TaskAdapter.

      Includes authentication support and configurable timeouts.

      '
  triggers:
  - a2a client
  - remote agent
  - send to agent
  - agent communication
  inputs:
    type: object
    required:
    - base_url
    properties:
      base_url:
        type: string
        description: Remote agent base URL
      auth:
        type: object
        description: AuthConfig for authentication headers
      timeout_seconds:
        type: number
        default: 30.0
  outputs:
    type: object
    properties:
      task_id:
        type: string
      status:
        type: string
      result:
        type: object
  evidence:
  - type: code
    ref: src/contextcore/agent/a2a_client.py
    description: A2AClient with send_text(), send_and_await(), get_agent_card()
  - type: code
    ref: src/contextcore/agent/a2a_adapter.py
    description: TaskAdapter bidirectional A2A Task ↔ Handoff conversion
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: 'Protocol 7: A2A interoperability — A2AClient, agent card discovery, send-and-await'
  - type: doc
    ref: docs/design/contextcore-a2a-comms-design.md
    description: A2A governance design — contract chain, trust boundaries, gate architecture
  confidence: 0.8
- capability_id: contextcore.a2a.task_adapter
  category: transform
  maturity: beta
  summary: Bidirectional translation between A2A Task JSON and ContextCore Handoff
  audiences:
  - agent
  - human
  description:
    agent: 'TaskAdapter. handoff_to_task(Handoff, messages?, artifacts?) → dict (A2A Task JSON). task_to_handoff(dict, from_agent,
      to_agent) → Handoff. Status mapping: 9 HandoffStatus ↔ 7 TaskState. Preserves ContextCore metadata in task.metadata.contextcore.

      '
    human: 'Provides bidirectional translation between A2A Task format and ContextCore

      Handoff objects. Maps all 9 HandoffStatus values to 7 A2A TaskState values

      and vice versa. Preserves ContextCore-specific metadata (from_agent, to_agent,

      capability_id, priority) in the A2A metadata field for round-trip fidelity.

      '
  triggers:
  - task adapter
  - a2a convert
  - handoff to task
  - task to handoff
  inputs:
    type: object
    description: Either a Handoff object or A2A Task dict
    properties:
      handoff:
        type: object
        description: ContextCore Handoff (for handoff_to_task)
      task:
        type: object
        description: A2A Task JSON (for task_to_handoff)
  outputs:
    type: object
    description: Converted object (A2A Task dict or ContextCore Handoff)
  evidence:
  - type: code
    ref: src/contextcore/agent/a2a_adapter.py
    description: TaskAdapter with status mapping tables and conversion methods
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: 'Protocol 7: TaskAdapter bidirectional conversion, status mapping tables'
  confidence: 0.85
- capability_id: contextcore.a2a.content_model
  category: transform
  maturity: beta
  summary: Unified Part/Message/Artifact content model compatible with A2A message format
  audiences:
  - agent
  - human
  description:
    agent: 'Content model. Part(type: PartType, content: str, metadata?: dict) with factories: Part.text(), Part.trace(),
      Part.file(), Part.json_data(), Part.query(), Part.reference(). Message(role: MessageRole, parts: Part[], agent_id?)
      with to_a2a_dict(). Artifact(parts, artifact_id?, trace_id?) with Artifact.from_json(), Artifact.from_insight().

      '
    human: 'A2A-compatible content model for agent communication. Part represents typed

      content units (text, traces, files, JSON data, queries). Message wraps parts

      with role (user/agent/system) and conversation context. Artifact packages

      output data with trace correlation. All types support to_a2a_dict() for

      serialization and from_a2a_dict() for deserialization.

      '
  triggers:
  - message model
  - a2a content
  - part model
  - artifact model
  - agent message
  - pipeline data model
  - stage output type
  - typed pipeline message
  inputs:
    type: object
    description: Constructor parameters vary by type
    properties:
      part_type:
        type: string
        enum:
        - text
        - file
        - data
        - json
        - form
        - trace
        - log_query
        - metric_query
        - trace_query
        - reference
      role:
        type: string
        enum:
        - user
        - agent
        - system
  outputs:
    type: object
    description: Part, Message, or Artifact instance with to_a2a_dict()
  evidence:
  - type: code
    ref: src/contextcore/models/part.py
    description: Part and PartType with factory methods and to_a2a_dict()
  - type: code
    ref: src/contextcore/models/message.py
    description: Message and MessageRole with A2A serialization
  - type: code
    ref: src/contextcore/models/artifact.py
    description: Artifact with from_json(), from_insight() factories
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: A2A content model — Part/Message/Artifact types, serialization, PartType taxonomy
  confidence: 0.85
  discovery_paths:
  - If you need typed data structures for passing between pipeline stages, use Part and Message.
  - If you need structured output from LLM agents, use Part.json_data() instead of string parsing.
- capability_id: contextcore.handoff.input_request
  category: action
  maturity: beta
  summary: Request additional input from delegating agent during handoff execution
  audiences:
  - agent
  - human
  description:
    agent: 'InputRequest. In: {handoff_id: string, question: string, input_type: enum[text|choice|multi_choice|confirmation|file],
      options?: InputOption[], default_value?, required: bool=true, timeout_ms: int=300000}. Transitions handoff to INPUT_REQUIRED.
      InputResponse: {request_id, handoff_id, value}. Handoff resumes to IN_PROGRESS on response.

      '
    human: 'Enables a receiving agent to request additional input from the delegating

      agent during handoff execution. Supports multiple input types (text, choice,

      multi-choice, confirmation, file upload). When an input request is created,

      the handoff transitions to INPUT_REQUIRED status and resumes to IN_PROGRESS

      when the response is received.

      '
  triggers:
  - input request
  - need more info
  - ask delegator
  - input required
  - clarification
  inputs:
    type: object
    required:
    - handoff_id
    - question
    - input_type
    properties:
      handoff_id:
        type: string
      question:
        type: string
        description: Question to ask the delegating agent
      input_type:
        type: string
        enum:
        - text
        - choice
        - multi_choice
        - confirmation
        - file
      options:
        type: array
        items:
          type: object
          properties:
            value:
              type: string
            label:
              type: string
            description:
              type: string
      default_value:
        type: string
      required:
        type: boolean
        default: true
      timeout_ms:
        type: integer
        default: 300000
  outputs:
    type: object
    properties:
      request_id:
        type: string
      handoff_id:
        type: string
      value:
        type: string
      responded_at:
        type: string
        format: datetime
  evidence:
  - type: code
    ref: src/contextcore/agent/input_request.py
    description: InputRequest, InputType, InputOption, InputResponse dataclasses
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: Input Request Protocol — request/response flow, input types, handoff state transitions
  confidence: 0.8
- capability_id: contextcore.api.unified
  category: integration
  maturity: beta
  summary: Unified API facade with resource.action naming for insights, handoffs, and skills
  audiences:
  - agent
  - human
  description:
    agent: 'ContextCoreAPI(project_id, agent_id). Properties: .insights (InsightsAPI), .handoffs (HandoffsAPI), .skills (SkillsAPI).
      InsightsAPI: emit(), emit_decision(), emit_lesson(), query(), get(), list(). HandoffsAPI: create(), get(), await_(),
      send(), accept(), complete(), fail(), subscribe(). SkillsAPI: emit(), query(), list(), get().

      '
    human: 'Unified API facade that wraps InsightEmitter, HandoffManager, and

      SkillCapabilityEmitter with a consistent resource.action naming pattern.

      Factory functions (create_insights_api, create_handoffs_api, create_skills_api)

      provide standalone access. ContextCoreAPI unifies all three as properties for

      single-import convenience.

      '
  triggers:
  - api facade
  - unified api
  - insights api
  - handoffs api
  - skills api
  inputs:
    type: object
    required:
    - project_id
    - agent_id
    properties:
      project_id:
        type: string
      agent_id:
        type: string
  outputs:
    type: object
    description: ContextCoreAPI instance with .insights, .handoffs, .skills
  evidence:
  - type: code
    ref: src/contextcore/api/__init__.py
    description: ContextCoreAPI, factory functions, InsightsAPI/HandoffsAPI/SkillsAPI
  - type: code
    ref: src/contextcore/api/insights.py
    description: InsightsAPI wrapping InsightEmitter and InsightQuerier
  - type: code
    ref: src/contextcore/api/handoffs.py
    description: HandoffsAPI wrapping HandoffManager and HandoffReceiver
  - type: code
    ref: src/contextcore/api/skills.py
    description: SkillsAPI with lazy initialization
  - type: doc
    ref: docs/agent-communication-protocol.md
    description: Unified API — JSON-RPC → HandoffsAPI mapping, InsightsAPI, SkillsAPI patterns
  confidence: 0.8
- capability_id: contextcore.manifest.load
  category: query
  maturity: stable
  summary: Load and parse Context Manifest (v1.1 or v2) with automatic version detection
  audiences:
  - agent
  - human
  description:
    agent: 'Load Context Manifest. In: {path: string} or {data: dict}. Out: ContextManifest (v1.1) or ContextManifestV2 (v2).
      Auto-detects version from apiVersion field. load_manifest() unified, load_manifest_v1()/load_manifest_v2() explicit.
      Validates against Pydantic schema.

      '
    human: 'Loads a Context Manifest from YAML file or dictionary with automatic version detection.

      Returns ContextManifest for v1.1 (apiVersion: contextcore.io/v1alpha1) or ContextManifestV2

      for v2 (apiVersion: contextcore.io/v1alpha2). The v2 format adds agent governance via

      the `guidance` section with constraints, focus areas, and questions.

      '
  triggers:
  - load context manifest
  - read contextcore yaml
  - parse project context
  - load business context
  inputs:
    type: object
    required: []
    properties:
      path:
        type: string
        description: Path to .contextcore.yaml file
      data:
        type: object
        description: Dict representation of manifest (for programmatic use)
  outputs:
    type: object
    properties:
      version:
        type: string
      spec:
        type: object
        description: ProjectContextSpec for K8s CRD
      objectives:
        type: array
        description: Business objectives with metrics
      strategies:
        type: array
        description: Strategies with tactics and horizons
      insights:
        type: array
        description: Derived insights with confidence
  evidence:
  - type: code
    ref: src/contextcore/models/manifest_loader.py
    description: load_manifest(), detect_manifest_version(), version-aware loading
  - type: code
    ref: src/contextcore/models/manifest.py
    description: ContextManifest v1.1 Pydantic model with validation
  - type: code
    ref: src/contextcore/models/manifest_v2.py
    description: ContextManifestV2 with AgentGuidanceSpec governance layer
  - type: doc
    ref: examples/context_manifest_example.yaml
    description: Complete v1.1 example manifest
  - type: doc
    ref: examples/context_manifest_v2_example.yaml
    description: Complete v2 example with guidance section
  - type: test
    ref: tests/test_manifest_v2.py
    description: 24 tests covering v2 models and version-aware loading
  confidence: 0.95
  anti_patterns:
  - Don't load manifest in hot paths—cache the parsed result
  - Don't embed sensitive data in manifest—it's checked into Git
  - Don't assume field names—grep model definition before instantiating
- capability_id: contextcore.manifest.distill_crd
  category: transform
  maturity: beta
  summary: Distill lightweight K8s ProjectContext CRD from full Context Manifest
  audiences:
  - agent
  - human
  description:
    agent: 'Distill CRD from manifest. In: {manifest: ContextManifest}. Out: ProjectContextSpec (K8s-ready). Extracts only
      spec section, discarding objectives/strategies/insights. Use for GitOps sync to cluster without context stuffing.

      '
    human: 'Extracts the operational spec from a full Context Manifest to produce a lightweight

      ProjectContext CRD suitable for Kubernetes. This implements the "Two-Context Architecture"

      where rich strategic context lives in the manifest, but only policy-driving metadata

      reaches the cluster. Prevents CRD bloat while maintaining single source of truth.

      '
  triggers:
  - distill crd
  - extract k8s spec
  - manifest to crd
  - generate projectcontext
  inputs:
    type: object
    required:
    - manifest
    properties:
      manifest:
        type: object
        description: Full ContextManifest object
  outputs:
    type: object
    description: ProjectContextSpec for K8s CRD
    properties:
      project:
        type: object
      business:
        type: object
      requirements:
        type: object
      targets:
        type: array
      observability:
        type: object
      risks:
        type: array
  evidence:
  - type: code
    ref: src/contextcore/models/manifest.py
    description: ContextManifest.spec field maps directly to CRD (line 75)
  - type: code
    ref: src/contextcore/models/core.py
    description: ProjectContextSpec Pydantic model
  confidence: 0.85
  delivers_benefit: context.unified_source_of_truth
- capability_id: contextcore.manifest.validate
  category: validate
  maturity: stable
  summary: Validate Context Manifest against schema with detailed error reporting
  audiences:
  - agent
  - human
  description:
    agent: 'Validate manifest schema. CLI: `contextcore manifest validate --path FILE [--strict] [--format text|json]`. In:
      {path: string, strict?: bool, format?: text|json}. Out: {valid: bool, errors: string[], warnings: string[]}. Checks:
      required fields, enum values, confidence ranges [0,1], strategy horizon enums, nested tactic structure. --strict fails
      on warnings. Exit 0 = valid, exit 1 = invalid.

      '
    human: 'Validates a Context Manifest against the Pydantic schema with comprehensive

      error reporting. Checks structural validity, required fields, enum constraints

      (e.g., StrategicHorizon must be now|next|later), and value ranges (e.g., confidence

      must be 0.0-1.0). Returns detailed errors with paths to invalid fields. Supports

      strict mode that fails on warnings. Also used as a prerequisite by `manifest export`

      which always validates before proceeding.

      '
  triggers:
  - validate manifest
  - check contextcore yaml
  - manifest schema check
  - validate context file
  inputs:
    type: object
    required:
    - path
    properties:
      path:
        type: string
        description: Path to .contextcore.yaml file
      strict:
        type: boolean
        default: false
        description: Fail on warnings (not just errors)
      format:
        type: string
        enum:
        - text
        - json
        default: text
  outputs:
    type: object
    properties:
      valid:
        type: boolean
      errors:
        type: array
        items:
          type: object
          properties:
            path:
              type: string
            message:
              type: string
            value:
              type: any
  evidence:
  - type: code
    ref: src/contextcore/models/manifest.py
    description: Pydantic BaseModel with Field validators
  - type: code
    ref: src/contextcore/cli/manifest.py
    description: manifest validate CLI command with --strict and --format
  - type: doc
    ref: docs/MANIFEST_EXPORT_REQUIREMENTS.md
    description: Formal requirements for manifest export and validate
  confidence: 0.9
- capability_id: contextcore.manifest.migrate
  category: transform
  maturity: stable
  summary: Migrate Context Manifest from v1.1 to v2 format non-destructively
  audiences:
  - agent
  - human
  description:
    agent: 'Migrate v1.1→v2. CLI: `contextcore manifest migrate --path FILE [--output FILE] [--in-place] [--dry-run]`. In:
      {path: string, output?: string, in_place?: bool}. Transforms: objectives→strategy.objectives, strategies.tactics→strategy.tactics
      (flattened), insights preserved with IDs, empty guidance section added, changelog entry appended. Creates .bak backup
      for --in-place. Non-destructive. Validates output against v2 schema.

      '
    human: 'Migrates a v1.1 Context Manifest to v2 format without data loss. Flattens the

      strategy/tactic hierarchy, preserves all existing data, adds an empty guidance

      section for agent governance, and appends a migration entry to the changelog.

      The output is validated against the v2 schema. Supports --in-place with automatic

      .bak backup, --dry-run for preview, and separate --output file.

      '
  triggers:
  - migrate manifest
  - upgrade to v2
  - convert context manifest
  - v1 to v2
  inputs:
    type: object
    required:
    - path
    properties:
      path:
        type: string
        description: Path to v1.1 manifest
      output:
        type: string
        description: 'Output path (default: stdout)'
      in_place:
        type: boolean
        default: false
        description: Overwrite source with .bak backup
      dry_run:
        type: boolean
        default: false
  outputs:
    type: object
    description: v2 manifest dict suitable for ContextManifestV2
    properties:
      apiVersion:
        type: string
        const: contextcore.io/v1alpha2
      strategy:
        type: object
        description: Flattened objectives and tactics
      guidance:
        type: object
        description: Empty governance section
  evidence:
  - type: code
    ref: src/contextcore/models/manifest_migrate.py
    description: migrate_v1_to_v2(), migrate_v1_to_v2_model(), validate_migration()
  - type: code
    ref: src/contextcore/cli/manifest.py
    description: manifest migrate CLI command with --in-place and --dry-run
  - type: test
    ref: tests/test_manifest_v2.py
    description: test_migrate_example_yaml_produces_valid_v2, test_migrate_preserves_changelog
  - type: doc
    ref: docs/MANIFEST_BOOTSTRAP_REQUIREMENTS.md
    description: Formal requirements for manifest init and migrate
  confidence: 0.9
  anti_patterns:
  - Don't modify v1 input in place without --in-place flag—migration returns new dict
  - Don't skip validation—always parse output as ContextManifestV2
- capability_id: contextcore.manifest.guidance.read
  category: query
  maturity: stable
  summary: Read agent guidance (constraints, focus, questions) from v2 manifest
  audiences:
  - agent
  - human
  description:
    agent: 'Read guidance from v2 manifest. In: {manifest: ContextManifestV2}. Out: AgentGuidanceSpec with {focus: Focus,
      constraints: Constraint[], preferences: Preference[], questions: Question[]}. Helpers: get_open_questions(), get_active_constraints().
      Constraints use ConstraintSeverity enum.

      '
    human: 'Reads the agent governance section from a v2 Context Manifest. The guidance section

      contains: focus areas (what to prioritize), constraints (what NOT to do with severity

      levels), preferences (recommended patterns), and questions (for agents to answer).

      Helper methods filter open questions and blocking constraints.

      '
  triggers:
  - read guidance
  - get constraints
  - agent focus
  - open questions
  - manifest governance
  inputs:
    type: object
    required:
    - manifest
    properties:
      manifest:
        type: object
        description: ContextManifestV2 instance
  outputs:
    type: object
    properties:
      focus:
        type: object
        properties:
          areas:
            type: array
            items:
              type: string
          reason:
            type: string
          until:
            type: string
      constraints:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
            rule:
              type: string
            severity:
              type: string
              enum:
              - blocking
              - warning
              - advisory
            appliesTo:
              type: array
              items:
                type: string
      questions:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
            question:
              type: string
            status:
              type: string
              enum:
              - open
              - answered
              - deferred
            priority:
              type: string
  evidence:
  - type: code
    ref: src/contextcore/models/manifest_v2.py
    description: AgentGuidanceSpec, Constraint, Focus, Preference, Question models
  - type: code
    ref: src/contextcore/models/manifest_v2.py
    description: ContextManifestV2.get_open_questions(), get_active_constraints()
  - type: test
    ref: tests/test_manifest_v2.py
    description: test_v2_get_open_questions, test_v2_get_active_constraints
  confidence: 0.9
  anti_patterns:
  - Never ignore BLOCKING constraints—they are mandatory
  - Don't assume v1 manifests have guidance—check apiVersion first
- capability_id: contextcore.manifest.sync_strategy
  category: action
  maturity: development
  summary: Sync strategy/tactic status bidirectionally with project management tools
  audiences:
  - agent
  - human
  description:
    agent: 'Sync strategy status. In: {manifest: ContextManifest, pm_source: enum[jira|github|linear]}. Out: {updated_tactics:
      Tactic[], sync_conflicts: Conflict[]}. Bidirectional: reads PM tool status, updates manifest tactics, optionally writes
      back. Detects conflicts when status diverges.

      '
    human: 'Enables bidirectional synchronization between the Context Manifest''s strategies/tactics

      and external project management tools (Jira, GitHub Projects, Linear). Reads current

      status from PM tool, updates manifest tactics, and optionally pushes updates back.

      Detects conflicts when manifest and PM tool have diverged.

      '
  triggers:
  - sync strategy status
  - update tactics from jira
  - bidirectional pm sync
  - strategy pm integration
  inputs:
    type: object
    required:
    - manifest
    - pm_source
    properties:
      manifest:
        type: object
      pm_source:
        type: string
        enum:
        - jira
        - github
        - linear
      direction:
        type: string
        enum:
        - read
        - write
        - bidirectional
        default: bidirectional
  outputs:
    type: object
    properties:
      updated_tactics:
        type: array
      sync_conflicts:
        type: array
  evidence:
  - type: doc
    ref: docs/CONTEXT_MANIFEST_VALUE_PROPOSITION.md
    description: Value proposition for PM tool integration
  confidence: 0.5
  delivers_benefit: context.unified_source_of_truth
  roadmap:
    phase: 2
    depends_on:
    - contextcore.manifest.load
    - contextcore.manifest.validate
    estimated_effort: large
    implements_frs:
    - FR-600
    - FR-601
- capability_id: contextcore.manifest.export_provenance
  category: action
  maturity: stable
  summary: Export artifact manifest with comprehensive provenance audit trail
  audiences:
  - agent
  - human
  description:
    agent: 'Export manifest with provenance. CLI: `contextcore manifest export --emit-provenance --embed-provenance`. Out:
      artifact-manifest.yaml + projectcontext.yaml + provenance.json. Provenance captures: git context (commit, branch, dirty),
      source checksum (SHA-256), environment (hostname, user, cwd), CLI args, duration. --emit-provenance writes separate
      file, --embed-provenance adds to manifest metadata.

      '
    human: 'Exports artifact manifest and ProjectContext CRD with comprehensive provenance

      metadata for audit trails and reproducibility. The provenance captures: git context

      (commit SHA, branch name, dirty state, remote URL), source file SHA-256 checksum,

      environment details (hostname, username, working directory, Python version), CLI

      invocation arguments, and export duration. Use --emit-provenance for a separate

      provenance.json file, or --embed-provenance to include it in the artifact manifest.

      '
  triggers:
  - export with provenance
  - audit trail
  - export manifest
  - generate artifact manifest
  - provenance metadata
  inputs:
    type: object
    required:
    - path
    properties:
      path:
        type: string
        description: Path to Context Manifest (.contextcore.yaml)
      output_dir:
        type: string
        description: Directory for generated files
      emit_provenance:
        type: boolean
        description: Write separate provenance.json file
        default: false
      embed_provenance:
        type: boolean
        description: Embed provenance in artifact manifest
        default: false
  outputs:
    type: object
    properties:
      artifact_manifest:
        type: string
        description: Path to generated artifact manifest
      projectcontext:
        type: string
        description: Path to generated CRD
      provenance:
        type: object
        description: Provenance metadata (if captured)
        properties:
          generatedAt:
            type: string
            format: date-time
          durationMs:
            type: integer
          sourcePath:
            type: string
          sourceChecksum:
            type: string
            description: SHA-256 of source file
          git:
            type: object
            properties:
              commitSha:
                type: string
              branch:
                type: string
              isDirty:
                type: boolean
              remoteUrl:
                type: string
          hostname:
            type: string
          username:
            type: string
          cliArgs:
            type: array
            items:
              type: string
  evidence:
  - type: code
    ref: src/contextcore/utils/provenance.py
    description: capture_provenance(), get_git_context(), get_file_checksum() utilities
  - type: code
    ref: src/contextcore/models/artifact_manifest.py
    description: GitContext, ExportProvenance Pydantic models
  - type: code
    ref: src/contextcore/cli/manifest.py
    description: export command with --emit-provenance and --embed-provenance flags
  - type: doc
    ref: docs/MANIFEST_EXPORT_REQUIREMENTS.md
    description: Formal requirements for manifest export and validate
  confidence: 0.9
  delivers_benefit: context.unified_source_of_truth
  anti_patterns:
  - Don't skip provenance for production exports—it's essential for debugging
  - Don't rely on embedded provenance alone if auditors need separate files
- capability_id: contextcore.manifest.init_bootstrap
  category: action
  maturity: stable
  summary: Scaffold a new v2 context manifest with validated template and pipeline next steps
  audiences:
  - agent
  - human
  description:
    agent: 'Bootstrap manifest. CLI: `contextcore manifest init --name PROJECT`. In: {name: string, path?: string, version?:
      v1.1|v2, force?: bool, validate?: bool}. Out: .contextcore.yaml file. Normalizes name (strip/lower/hyphen), validates
      after write, prints 6-step pipeline next steps. Refuses overwrite without --force.

      '
    human: 'Creates a new `.contextcore.yaml` manifest with a starter template. The v2 template

      includes all required sections: project, business, requirements, targets, observability,

      risks, strategy, and guidance. After writing, validates the manifest and prints next steps

      guiding the user through validate → export → Gate 1 → plan ingestion → Gate 2.

      '
  triggers:
  - init manifest
  - create manifest
  - bootstrap project
  - new contextcore yaml
  - scaffold manifest
  inputs:
    type: object
    required:
    - name
    properties:
      name:
        type: string
        description: Project/manifest name (auto-normalized to lowercase-hyphen)
      path:
        type: string
        default: .contextcore.yaml
      version:
        type: string
        enum:
        - v1.1
        - v2
        default: v2
      force:
        type: boolean
        default: false
      validate:
        type: boolean
        default: true
  outputs:
    type: object
    properties:
      path:
        type: string
        description: Path to created manifest file
      version:
        type: string
      validation_passed:
        type: boolean
  evidence:
  - type: code
    ref: src/contextcore/cli/manifest.py
    description: manifest init command with template generation and validation
  - type: doc
    ref: docs/MANIFEST_BOOTSTRAP_REQUIREMENTS.md
    description: Formal requirements for manifest init and migrate
  confidence: 0.9
  anti_patterns:
  - Don't skip post-write validation—invalid templates indicate a bug
- capability_id: contextcore.pipeline.check_pipeline
  category: validate
  maturity: stable
  summary: Run 7 integrity checks on export output before plan ingestion (Gate 1)
  audiences:
  - agent
  - human
  description:
    agent: 'Gate 1 pipeline check. CLI: `contextcore contract a2a-check-pipeline OUTPUT_DIR [--min-coverage N]`. Reads onboarding-metadata.json
      + optional provenance.json. Runs 7 gates in order: 1) structural-integrity (required fields), 2) checksum-chain (SHA-256
      recompute), 3) provenance-consistency (cross-check, skipped without provenance.json), 4) mapping-completeness (gaps→tasks,
      skipped without mapping), 5) gap-parity (gaps→features alignment), 6) design-calibration (depth hints, skipped without
      hints), 7) parameter-resolvability (parameter_sources resolve to populated fields). Optional: --min-coverage enforces
      a coverage threshold (blocking FAIL if below). Out: PipelineCheckReport {health: healthy|degraded|unhealthy, gates:
      GateResult[]}. --fail-on-unhealthy exits 1.

      '
    human: 'Runs 7 integrity checks on a real export output directory, plus optional --min-coverage

      threshold enforcement. This is Gate 1 in the 7-step A2A governance-aware pipeline,

      validating the handoff from ContextCore to plan ingestion. Gates 1-2 always run;

      gates 3-7 are skipped when their input data is absent. Produces a detailed report

      with per-gate outcomes, evidence items, and recommendations. Default mode is advisory

      (exit 0); use --fail-on-unhealthy for CI.

      '
  triggers:
  - check pipeline
  - gate 1
  - pipeline integrity
  - validate export
  - a2a check
  - pre-ingestion validation
  inputs:
    type: object
    required:
    - output_dir
    properties:
      output_dir:
        type: string
        description: Export output directory containing onboarding-metadata.json
      task_id:
        type: string
        description: Task span ID for gate context
      trace_id:
        type: string
        description: Trace ID for gate context
      report_path:
        type: string
        description: Path to write JSON report
      fail_on_unhealthy:
        type: boolean
        default: false
      min_coverage:
        type: number
        description: Minimum coverage threshold (0.0-1.0). Fails if below.
  outputs:
    type: object
    properties:
      health:
        type: string
        enum:
        - healthy
        - degraded
        - unhealthy
      gates:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            outcome:
              type: string
              enum:
              - pass
              - fail
              - skip
            evidence:
              type: array
  evidence:
  - type: code
    ref: src/contextcore/contracts/a2a/pipeline_checker.py
    description: PipelineChecker class with 7-gate suite + min-coverage enforcement
  - type: code
    ref: src/contextcore/cli/contract.py
    description: a2a-check-pipeline CLI command
  - type: doc
    ref: docs/A2A_GATE_REQUIREMENTS.md
    description: Formal requirements for Gate 1 and Gate 2
  - type: doc
    ref: docs/OPERATOR_PIPELINE_QUICKSTART.md
    description: Operator quickstart for running and troubleshooting the ContextCore pipeline
  confidence: 0.9
  anti_patterns:
  - Don't skip Gate 1 before plan ingestion—defects cascade silently
  - Don't treat skipped gates as failures—they mean input data was optional
- capability_id: contextcore.pipeline.diagnose
  category: validate
  maturity: stable
  summary: Run Three Questions diagnostic across export, ingestion, and execution layers (Gate 2)
  audiences:
  - agent
  - human
  description:
    agent: 'Gate 2 diagnostic. CLI: `contextcore contract a2a-diagnose EXPORT_DIR [--ingestion-dir DIR] [--artisan-dir DIR]`.
      Three Questions in order: Q1 "Is the contract complete?" (runs Gate 1 + enrichment checks), Q2 "Was the contract faithfully
      translated?" (plan ingestion output validation, requires --ingestion-dir), Q3 "Was the translated plan faithfully executed?"
      (contractor output, requires --artisan-dir). Stops at first failure. Status: pass|fail|skipped|not_reached. --fail-on-issue
      exits 1.

      '
    human: 'Runs the Three Questions diagnostic on a pipeline execution. Walks through questions

      in strict order, stopping at the first failure. Q1 checks the export layer (includes

      Gate 1 as a sub-check). Q2 checks plan ingestion translation fidelity. Q3 checks

      contractor execution completeness. The key insight: if Q1 fails, fixing Q2 or Q3

      is wasted effort. Always start from the source.

      '
  triggers:
  - diagnose pipeline
  - gate 2
  - three questions
  - pipeline diagnostic
  - a2a diagnose
  - is the contract complete
  inputs:
    type: object
    required:
    - export_dir
    properties:
      export_dir:
        type: string
        description: Export output directory
      ingestion_dir:
        type: string
        description: Plan ingestion output directory (enables Q2)
      artisan_dir:
        type: string
        description: Artisan workflow output directory (enables Q3)
      trace_id:
        type: string
      report_path:
        type: string
      fail_on_issue:
        type: boolean
        default: false
  outputs:
    type: object
    properties:
      questions:
        type: array
        items:
          type: object
          properties:
            number:
              type: integer
            title:
              type: string
            layer:
              type: string
            status:
              type: string
              enum:
              - pass
              - fail
              - skipped
              - not_reached
            recommendation:
              type: string
  evidence:
  - type: code
    ref: src/contextcore/contracts/a2a/three_questions.py
    description: ThreeQuestionsDiagnostic class with sequential execution
  - type: code
    ref: src/contextcore/cli/contract.py
    description: a2a-diagnose CLI command
  - type: doc
    ref: docs/A2A_GATE_REQUIREMENTS.md
    description: Formal requirements for Gate 1 and Gate 2
  - type: doc
    ref: docs/OPERATOR_PIPELINE_QUICKSTART.md
    description: Operator quickstart for running and troubleshooting the ContextCore pipeline
  confidence: 0.9
  anti_patterns:
  - Don't fix Q2/Q3 issues while Q1 is failing—always start from the source
  - Don't confuse 'skipped' (missing input data) with 'not_reached' (prior question failed)
  dependencies:
  - contextcore.pipeline.check_pipeline
- capability_id: contextcore.docs.index
  category: action
  maturity: stable
  summary: Generate programmatic documentation index from capability evidence and directory scan
  audiences:
  - agent
  - human
  description:
    agent: 'Documentation index generator. CLI: `contextcore docs index [--no-git] [--dry-run] [--format yaml|json] [-o PATH]`.

      Scans capability index YAMLs for type: doc evidence, walks docs/ and plans/ directories,

      classifies documents by type (requirements, design, operational, adr, analysis, plan, reference,

      session, governance), extracts titles, detects maturity, finds cross-references, and fetches git

      freshness. Output: docs/capability-index/contextcore.docs.yaml. Inverts the capability→evidence

      relationship: each document entry shows which capabilities it governs. Identifies orphaned docs.

      '
    human: 'Builds a documentation catalog that tracks every doc artifact in the project—what type

      it is, what capabilities it supports, what other docs it references, and when it was

      last modified. The index is fully programmatic: never hand-edit the output, just re-run

      the command. Use `contextcore docs show` to query the generated index with filters.

      '
  triggers:
  - generate docs index
  - documentation index
  - docs index
  - rebuild docs catalog
  - index documentation
  inputs:
    type: object
    properties:
      output:
        type: string
        description: 'Output file path (default: docs/capability-index/contextcore.docs.yaml)'
      no_git:
        type: boolean
        default: false
        description: Skip git freshness lookup for faster generation
      dry_run:
        type: boolean
        default: false
        description: Print to stdout without writing file
      format:
        type: string
        enum:
        - yaml
        - json
        default: yaml
  outputs:
    type: object
    properties:
      manifest_id:
        type: string
      summary:
        type: object
        properties:
          total_documents:
            type: integer
          referenced_by_capabilities:
            type: integer
          orphaned:
            type: integer
          cross_references:
            type: integer
          by_type:
            type: object
      documents:
        type: array
        items:
          type: object
          properties:
            doc_id:
              type: string
            path:
              type: string
            type:
              type: string
            maturity:
              type: string
            referenced:
              type: boolean
            governs_capabilities:
              type: array
            references:
              type: array
  evidence:
  - type: code
    ref: src/contextcore/cli/docs.py
    description: CLI command group with index and show subcommands
  - type: code
    ref: scripts/generate_docs_index.py
    description: Standalone generator script (CI-compatible)
  - type: doc
    ref: docs/DOCS_INDEX_REQUIREMENTS.md
    description: Formal requirements for docs index and show commands
  - type: doc
    ref: docs/capability-index/contextcore.docs.yaml
    description: Generated output artifact
  confidence: 0.9
  anti_patterns:
  - Don't hand-edit contextcore.docs.yaml—it is overwritten on every regeneration
  - Don't treat orphaned docs as 'bad'—they may be valid docs not yet linked to capabilities
- capability_id: contextcore.docs.show
  category: query
  maturity: stable
  summary: Query the documentation index with type, capability, freshness, and cross-reference filters
  audiences:
  - agent
  - human
  description:
    agent: 'Read-only query against contextcore.docs.yaml. CLI: `contextcore docs show [--type TYPE] [--orphaned] [--referenced]
      [--capability ID] [--refs-for PATH] [--stale-days N] [--format text|json|yaml]`.

      Default (no filters): summary with type breakdown histogram. --refs-for shows bidirectional cross-reference graph (inbound
      + outbound). --stale-days N finds docs not modified in N days. Returns filtered document entries.

      '
    human: 'Queries the generated documentation index to answer questions like "which requirements

      docs exist?", "what references this document?", and "which docs haven''t been updated

      in 30 days?". Without filters, shows a summary dashboard with type breakdown.

      '
  triggers:
  - show docs
  - query documentation
  - list requirements docs
  - find stale docs
  - doc cross-references
  - orphaned documentation
  inputs:
    type: object
    properties:
      index_path:
        type: string
        description: 'Path to docs index (default: docs/capability-index/contextcore.docs.yaml)'
      type:
        type: string
        enum:
        - requirements
        - design
        - operational
        - adr
        - analysis
        - plan
        - reference
        - session
        - governance
      orphaned:
        type: boolean
      referenced:
        type: boolean
      capability:
        type: string
        description: Filter docs governing a specific capability ID
      refs_for:
        type: string
        description: Show cross-reference graph for a document path
      stale_days:
        type: integer
        description: Show documents not modified in N days
  outputs:
    type: object
    description: Filtered document entries or summary statistics
  evidence:
  - type: code
    ref: src/contextcore/cli/docs.py
    description: CLI show subcommand with filter logic
  - type: doc
    ref: docs/DOCS_INDEX_REQUIREMENTS.md
    description: Formal requirements for docs index and show commands
  confidence: 0.9
  dependencies:
  - contextcore.docs.index
- capability_id: contextcore.docs.audit
  category: validate
  maturity: stable
  summary: Audit documentation gaps by scoring capability importance and detecting missing doc types
  audiences:
  - agent
  - human
  description:
    agent: 'Documentation gap detector. CLI: `contextcore docs audit [--min-importance FLOAT] [--type TYPE] [--verbose] [--format
      text|json|yaml]`.

      Reads all 4 capability index files (agent, user, benefits, roadmap) plus contextcore.docs.yaml.

      Computes per-capability importance score (4 dimensions: maturity-confidence 30%, structural complexity 25%,

      cross-cutting impact 25%, benefit linkage 20%). Applies 8 rules mapping capability profiles to expected doc

      types (R1-R8). Detects gaps: expected - actual doc types. Consolidates by namespace cluster. Output sorted

      by priority (high/medium/low). --verbose shows per-capability detail within clusters.

      '
    human: 'Reverse-engineers the capability index to answer: "which capabilities should have documentation

      but don''t?" Scores each capability''s importance based on maturity, complexity, how many other

      capabilities depend on it, and whether it delivers a high-priority benefit. Applies rules to

      determine which doc types (requirements, design, operational, adr, reference) should exist.

      Reports gaps consolidated by namespace cluster with suggested filenames and rationale.

      '
  triggers:
  - audit documentation
  - find documentation gaps
  - missing docs
  - documentation coverage
  - docs audit
  - which docs are missing
  inputs:
    type: object
    properties:
      index_path:
        type: string
        description: 'Path to docs index (default: docs/capability-index/contextcore.docs.yaml)'
      min_importance:
        type: number
        default: 0.3
        description: Only report gaps above this importance threshold (0.0-1.0)
      type:
        type: string
        enum:
        - requirements
        - design
        - operational
        - adr
        - reference
        description: Filter to show only gaps of a specific doc type
      verbose:
        type: boolean
        default: false
        description: Show per-capability detail within cluster summaries
      format:
        type: string
        enum:
        - text
        - json
        - yaml
        default: text
  outputs:
    type: object
    properties:
      summary:
        type: object
        properties:
          capabilities_analyzed:
            type: integer
          with_documentation_gaps:
            type: integer
          cluster_gaps_identified:
            type: integer
          priority_breakdown:
            type: object
          missing_doc_types:
            type: object
      clusters:
        type: array
        items:
          type: object
          properties:
            cluster:
              type: string
            missing_type:
              type: string
            avg_importance:
              type: number
            suggested_file:
              type: string
            priority:
              type: string
              enum:
              - high
              - medium
              - low
      per_capability_gaps:
        type: array
  evidence:
  - type: code
    ref: src/contextcore/cli/docs.py
    description: Audit subcommand with importance scorer, rules engine, gap detector, cluster consolidator
  - type: doc
    ref: docs/DOCS_INDEX_REQUIREMENTS.md
    description: Formal requirements including FR-D-200 series for audit command
  confidence: 0.9
  anti_patterns:
  - Don't treat all gaps as equal—importance scoring exists for a reason
  - Don't create docs for low-importance draft capabilities—wait until maturity increases
  dependencies:
  - contextcore.docs.index
- capability_id: contextcore.docs.curate
  category: query
  maturity: stable
  summary: Curate persona-specific documentation catalogs with onboarding/operations classification and gap detection
  audiences:
  - agent
  - human
  description:
    agent: 'Persona documentation curator. CLI: `contextcore docs curate [--persona ID] [--category onboarding|operations]
      [--gaps-only] [--min-relevance FLOAT] [--format text|json|yaml]`.

      Traces three discovery signals: (1) persona → capabilities → evidence[type=doc] (score 0.9),

      (2) persona → benefits → delivered_by capabilities → evidence[type=doc] (score 0.7),

      (3) persona role → document type affinity (score 0.4). Signals merge by max score.

      Classifies each document as onboarding or operations. Detects persona-specific gaps

      (missing onboarding/operations docs, uncovered critical benefits, persona-role-specific gaps).

      '
    human: 'Maps documentation to user personas (developer, project_manager, engineering_leader,

      operator, compliance, ai_agent) for tailored onboarding and operations catalogs.

      Uses three signals to discover relevant docs: direct capability evidence links,

      benefit delivery chains, and document type affinity. Each document gets a relevance

      score and is classified as onboarding or operations material. Reports gaps where

      expected persona-specific documentation is missing.

      '
  triggers:
  - persona documentation
  - persona docs
  - onboarding docs for
  - operations docs for
  - documentation by persona
  - docs curate
  - who needs what docs
  inputs:
    type: object
    properties:
      index_path:
        type: string
        description: 'Path to docs index (default: docs/capability-index/contextcore.docs.yaml)'
      persona:
        type: string
        description: Filter to a single persona (e.g., operator, developer)
      category:
        type: string
        enum:
        - onboarding
        - operations
        description: Show only onboarding or operations documents
      gaps_only:
        type: boolean
        default: false
        description: Only show documentation gaps, not full catalog
      min_relevance:
        type: number
        default: 0.4
        description: Minimum document-persona relevance threshold (0.0-1.0)
      format:
        type: string
        enum:
        - text
        - json
        - yaml
        default: text
  outputs:
    type: object
    properties:
      summary:
        type: object
        properties:
          personas_analyzed:
            type: integer
          total_documentation_gaps:
            type: integer
          high_priority_gaps:
            type: integer
          avg_docs_per_persona:
            type: number
      personas:
        type: array
        items:
          type: object
          properties:
            persona_id:
              type: string
            name:
              type: string
            capability_count:
              type: integer
            benefit_count:
              type: integer
            onboarding:
              type: array
              description: Docs classified as onboarding material
            operations:
              type: array
              description: Docs classified as operations material
            gaps:
              type: array
              description: Missing persona-specific documentation
  evidence:
  - type: code
    ref: src/contextcore/cli/docs.py
    description: Personas subcommand with chain walker, document matcher, classifier, gap detector
  - type: doc
    ref: docs/DOCS_INDEX_REQUIREMENTS.md
    description: Formal requirements including FR-D-300 series for curate command
  confidence: 0.9
  anti_patterns:
  - Don't assume all docs are equally relevant to all personas—use the relevance score
  - Don't create persona-specific docs that merely duplicate existing general docs—add persona-specific context
  personas:
  - developer
  - project_manager
  - engineering_leader
  - operator
  - compliance
  - ai_agent
  dependencies:
  - contextcore.docs.index
  - contextcore.docs.audit
- capability_id: contextcore.manifest.export_onboarding
  category: action
  maturity: stable
  summary: Emit programmatic onboarding metadata for plan ingestion and artisan seed enrichment
  audiences:
  - agent
  - human
  description:
    agent: 'Export onboarding metadata for downstream workflows. CLI: `contextcore manifest export`

      (default, use --no-onboarding to disable). Output: onboarding-metadata.json with:

      artifact type schemas (parameter keys, parameter sources, output conventions, example

      snippets), coverage gaps, semantic conventions, checksums (artifact_manifest_checksum,

      project_context_checksum, source_checksum), artifact_task_mapping, and provenance chain.

      Consumed by: plan ingestion PARSE/ASSESS phases, artisan context seed enrichment.

      '
    human: 'Produces a machine-actionable onboarding metadata file that bridges the gap between

      "what artifacts are needed" (the artifact manifest) and "how to build them" (schemas,

      conventions, examples). This file is the programmatic bridge consumed by the plan

      ingestion workflow and artisan context seed enrichment. Emitted by default on every

      export; use --no-onboarding to opt out. Includes integrity checksums for validation

      at every handoff, artifact ID → task ID mapping for traceability, and the provenance

      chain (source_checksum) enabling end-to-end freshness verification.

      '
  triggers:
  - export onboarding
  - onboarding metadata
  - plan ingestion context
  - artisan seed
  - programmatic onboarding
  inputs:
    type: object
    required:
    - artifact_manifest
    - artifact_manifest_path
    - project_context_path
    properties:
      artifact_manifest:
        type: object
        description: The generated ArtifactManifest instance
      artifact_manifest_path:
        type: string
        description: Relative path to artifact manifest file
      project_context_path:
        type: string
        description: Relative path to project context CRD file
      provenance:
        type: object
        description: Optional ExportProvenance for audit chain
      artifact_task_mapping:
        type: object
        description: Optional artifact_id → plan task ID mapping
      source_path:
        type: string
        description: Path to source .contextcore.yaml for checksum
  outputs:
    type: object
    properties:
      version:
        type: string
        description: Schema version
      schema:
        type: string
        description: contextcore.io/onboarding-metadata/v1
      project_id:
        type: string
      artifact_types:
        type: object
        description: Per-type schemas with parameter_keys, parameter_sources, output conventions, example snippets
      coverage:
        type: object
        description: Overall coverage percentage, gaps list, by-type breakdown
      semantic_conventions:
        type: object
        description: Metric names, label conventions for dashboard/rule generation
      artifact_manifest_checksum:
        type: string
        description: SHA-256 of artifact manifest content
      project_context_checksum:
        type: string
        description: SHA-256 of CRD content
      source_checksum:
        type: string
        description: SHA-256 of .contextcore.yaml for provenance chain
      artifact_task_mapping:
        type: object
        description: artifact_id → plan task ID mapping for traceability
  evidence:
  - type: code
    ref: src/contextcore/utils/onboarding.py
    description: build_onboarding_metadata() with ARTIFACT_PARAMETER_SOURCES, ARTIFACT_PARAMETER_SCHEMA, ARTIFACT_EXAMPLE_OUTPUTS
  - type: code
    ref: src/contextcore/cli/manifest.py
    description: export command writes onboarding-metadata.json by default (lines 812-834)
  - type: doc
    ref: docs/EXPORT_PIPELINE_ANALYSIS_GUIDE.md
    description: Full pipeline analysis guide documenting onboarding metadata consumption by plan ingestion and artisan
  - type: doc
    ref: docs/MANIFEST_EXPORT_REQUIREMENTS.md
    description: Formal requirements for manifest export and validate
  confidence: 0.9
  delivers_benefit: context.unified_source_of_truth
  anti_patterns:
  - Don't hand-edit onboarding-metadata.json—re-export instead, as checksums will break
  - Don't skip onboarding metadata for plan ingestion—ASSESS phase needs parameter schemas and coverage gaps
- capability_id: contextcore.aos.message_emit
  category: action
  maturity: development
  summary: Emit AOS-compliant steps/message events for agent communication
  audiences:
  - agent
  - human
  description:
    agent: 'Emit AOS message event. In: {role: enum[user|agent|system], content: string, reasoning?: string, citations?: Citation[]}.
      Out: {event_id: string, trace_id: string}. Emits steps/message event with AOS-compliant attributes. Dual-emits with
      existing spans.

      '
    human: 'Emits message events following the OWASP Agent Observability Standard (AOS)

      format. Captures message exchanges with sender role, content, reasoning,

      and citations. Enables interoperability with AOS-compliant observability

      tools without custom adapters.

      '
  triggers:
  - aos message
  - emit message event
  - aos compliant
  - steps/message
  inputs:
    type: object
    required:
    - role
    - content
    properties:
      role:
        type: string
        enum:
        - user
        - agent
        - system
        description: Message sender role
      content:
        type: string
        description: Message content
      reasoning:
        type: string
        description: Agent reasoning behind the message
      citations:
        type: array
        items:
          type: object
          properties:
            source:
              type: string
            text:
              type: string
            confidence:
              type: number
  outputs:
    type: object
    properties:
      event_id:
        type: string
      trace_id:
        type: string
      aos_compliant:
        type: boolean
        const: true
  evidence:
  - type: doc
    ref: docs/STANDARDS_ALIGNMENT.md
    description: AOS event mapping documentation
  confidence: 0.5
  delivers_benefit: interop.aos_compliance
  roadmap:
    phase: 1
    depends_on: []
    estimated_effort: small
    implements_frs:
    - FR-100
- capability_id: contextcore.aos.decision_emit
  category: action
  maturity: development
  summary: Emit AOS-compliant guardian decisions with Allow/Deny/Modify outcomes
  audiences:
  - agent
  - human
  description:
    agent: 'Emit AOS decision event. In: {outcome: enum[allow|deny|modify], reason_code: string, reasoning: string, modified_request?:
      object}. Out: {decision_id: string, trace_id: string}. Extends insight.emit with AOS decision semantics. outcome=modify
      requires modified_request.

      '
    human: 'Emits guardian-style decision events following the OWASP AOS format.

      Decisions have explicit outcomes (Allow, Deny, Modify) with structured

      reason codes. For Modify outcomes, includes the modified request details.

      Builds on the existing insight system with AOS-specific attributes.

      '
  triggers:
  - aos decision
  - guardian decision
  - allow deny modify
  - emit decision
  inputs:
    type: object
    required:
    - outcome
    - reason_code
    - reasoning
    properties:
      outcome:
        type: string
        enum:
        - allow
        - deny
        - modify
        description: Decision outcome
      reason_code:
        type: string
        description: Structured reason code (e.g., rate_limit_exceeded, policy_violation)
      reasoning:
        type: string
        description: Human-readable explanation
      modified_request:
        type: object
        description: Required when outcome=modify; the altered request
  outputs:
    type: object
    properties:
      decision_id:
        type: string
      trace_id:
        type: string
      insight_id:
        type: string
  evidence:
  - type: doc
    ref: docs/STANDARDS_ALIGNMENT.md
    description: AOS decision event mapping
  confidence: 0.5
  delivers_benefit: interop.aos_compliance
  roadmap:
    phase: 1
    depends_on:
    - contextcore.insight.emit
    estimated_effort: small
    implements_frs:
    - FR-102
    - FR-103
- capability_id: contextcore.aos.trigger_emit
  category: action
  maturity: development
  summary: Emit AOS-compliant steps/agentTrigger events for autonomous activations
  audiences:
  - agent
  - human
  description:
    agent: 'Emit AOS agent trigger event. In: {trigger_type: enum[user|autonomous|webhook|scheduled], source?: string, payload?:
      object}. Out: {event_id: string, trace_id: string}. Records autonomous agent activations per AOS spec.

      '
    human: 'Emits agent trigger events following the OWASP AOS format. Captures

      how the agent was activated (user interaction, autonomous decision,

      webhook, scheduled task). Essential for distinguishing human-initiated

      vs autonomous agent actions in observability data.

      '
  triggers:
  - aos trigger
  - agent activation
  - autonomous trigger
  - steps/agentTrigger
  inputs:
    type: object
    required:
    - trigger_type
    properties:
      trigger_type:
        type: string
        enum:
        - user
        - autonomous
        - webhook
        - scheduled
        description: How the agent was activated
      source:
        type: string
        description: Source identifier (webhook URL, cron expression, etc.)
      payload:
        type: object
        description: Trigger payload data
  outputs:
    type: object
    properties:
      event_id:
        type: string
      trace_id:
        type: string
  evidence:
  - type: doc
    ref: docs/STANDARDS_ALIGNMENT.md
    description: AOS trigger event mapping
  confidence: 0.5
  delivers_benefit: interop.aos_compliance
  roadmap:
    phase: 1
    depends_on: []
    estimated_effort: small
    implements_frs:
    - FR-101
- capability_id: contextcore.aos.mcp_emit
  category: action
  maturity: development
  summary: Emit AOS-compliant protocols/MCP events for Model Context Protocol interactions
  audiences:
  - agent
  - human
  description:
    agent: 'Emit MCP protocol event. In: {event_type: enum[tools_list|tool_call|resource_read|prompt_get], tool_name?: string,
      arguments?: object, resource_uri?: string, result?: object, error?: object}. Out: {event_id: string, trace_id: string}.
      Maps MCP interactions to ContextCore capabilities.

      '
    human: 'Emits Model Context Protocol (MCP) events following the OWASP AOS format.

      Captures tool listing, tool calls, resource reads, and prompt retrieval

      operations. Maps MCP tool invocations to ContextCore capability lookups,

      enabling unified observability across MCP and native ContextCore operations.

      '
  triggers:
  - mcp event
  - protocols/MCP
  - mcp tool call
  - mcp telemetry
  inputs:
    type: object
    required:
    - event_type
    properties:
      event_type:
        type: string
        enum:
        - tools_list
        - tool_call
        - resource_read
        - prompt_get
      tool_name:
        type: string
        description: Tool name for tool_call events
      arguments:
        type: object
        description: Tool arguments for tool_call events
      resource_uri:
        type: string
        description: Resource URI for resource_read events
      result:
        type: object
        description: Operation result
      error:
        type: object
        description: Error details if operation failed
  outputs:
    type: object
    properties:
      event_id:
        type: string
      trace_id:
        type: string
      mapped_capability_id:
        type: string
  evidence:
  - type: doc
    ref: docs/STANDARDS_ALIGNMENT.md
    description: MCP protocol event mapping
  confidence: 0.5
  delivers_benefit: interop.aos_compliance
  roadmap:
    phase: 2
    depends_on:
    - contextcore.handoff.initiate
    estimated_effort: medium
    implements_frs:
    - FR-200
    - FR-201
- capability_id: contextcore.aos.validate
  category: query
  maturity: development
  summary: Validate trace data against AOS schema and report compliance gaps
  audiences:
  - agent
  - human
  description:
    agent: 'Validate AOS compliance. In: {trace_id?: string, time_range?: string, event_types?: string[]}. Out: {compliant:
      bool, score: float, missing_attributes: object[], invalid_events: object[], recommendations: string[]}. Checks emitted
      events against AOS spec.

      '
    human: 'Validates trace data against the OWASP Agent Observability Standard schema.

      Reports compliance score, identifies missing required attributes, and flags

      invalid event structures. Provides recommendations for achieving full

      AOS compliance. Can validate specific traces or scan time ranges.

      '
  triggers:
  - validate aos
  - aos compliance check
  - check aos schema
  - aos audit
  inputs:
    type: object
    properties:
      trace_id:
        type: string
        description: Specific trace to validate
      time_range:
        type: string
        description: Time range to scan (e.g., "24h", "7d")
      event_types:
        type: array
        items:
          type: string
        description: Filter to specific event types
  outputs:
    type: object
    properties:
      compliant:
        type: boolean
      score:
        type: number
        minimum: 0
        maximum: 100
      missing_attributes:
        type: array
        items:
          type: object
          properties:
            event_type:
              type: string
            attribute:
              type: string
            required:
              type: boolean
      invalid_events:
        type: array
        items:
          type: object
          properties:
            event_id:
              type: string
            reason:
              type: string
      recommendations:
        type: array
        items:
          type: string
  evidence:
  - type: doc
    ref: docs/STANDARDS_ALIGNMENT.md
    description: AOS schema validation requirements
  confidence: 0.5
  delivers_benefit: interop.aos_compliance
  roadmap:
    phase: 1
    depends_on: []
    estimated_effort: small
    implements_frs: []
- capability_id: contextcore.contract.propagation
  category: transform
  maturity: beta
  summary: Declare end-to-end field flow contracts, validate at phase boundaries, track provenance
  triggers:
  - context contract
  - propagation chain
  - boundary validation
  - field flow
  - context propagation
  - chain status
  confidence: 0.9
  evidence:
    source_dir: src/contextcore/contracts/propagation
    files:
    - schema.py
    - loader.py
    - validator.py
    - otel.py
    - tracker.py
    test_count: 6
    layer: L1
  description:
    agent: Pydantic v2 models for context propagation contract YAML format.
  discovery_paths:
  - If you need to ensure context fields survive through multiple pipeline stages.
  - If you need boundary validation at phase transitions.
- capability_id: contextcore.contract.schema_compat
  category: transform
  maturity: beta
  summary: Cross-service schema compatibility checking with field mapping and value translation
  triggers:
  - schema compatibility
  - contract drift
  - field mapping
  - value translation
  - schema evolution
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/schema_compat
    files:
    - schema.py
    - loader.py
    - otel.py
    test_count: 5
    layer: L2
  description:
    agent: Pydantic v2 models for schema compatibility contract YAML format.
- capability_id: contextcore.contract.semantic_convention
  category: transform
  maturity: beta
  summary: Attribute naming and enum consistency enforcement across services
  triggers:
  - semantic convention
  - attribute naming
  - enum consistency
  - naming convention enforcement
  confidence: 0.9
  evidence:
    source_dir: src/contextcore/contracts/semconv
    files:
    - schema.py
    - loader.py
    - validator.py
    - otel.py
    test_count: 1
    layer: L3
  description:
    agent: Pydantic v2 models for semantic convention contract YAML format.
- capability_id: contextcore.contract.causal_ordering
  category: transform
  maturity: beta
  summary: Cross-boundary event ordering contracts with timestamp verification
  triggers:
  - causal ordering
  - event ordering
  - ordering constraint
  - happens-before
  confidence: 0.9
  evidence:
    source_dir: src/contextcore/contracts/ordering
    files:
    - schema.py
    - loader.py
    - validator.py
    - otel.py
    test_count: 1
    layer: L4
  description:
    agent: Pydantic v2 models for causal ordering contract YAML format.
- capability_id: contextcore.contract.capability_propagation
  category: transform
  maturity: beta
  summary: End-to-end permission and capability flow verification through call chains
  triggers:
  - capability propagation
  - permission flow
  - authorization chain
  - capability verification
  confidence: 0.9
  evidence:
    source_dir: src/contextcore/contracts/capability
    files:
    - schema.py
    - loader.py
    - validator.py
    - otel.py
    - tracker.py
    test_count: 1
    layer: L5
  description:
    agent: Pydantic v2 models for capability propagation contract YAML format.
- capability_id: contextcore.contract.slo_budget
  category: transform
  maturity: beta
  summary: Per-hop latency budget allocation, tracking, and DEGRADED/BROKEN signaling
  triggers:
  - SLO budget
  - latency budget
  - budget tracking
  - deadline propagation
  confidence: 0.9
  evidence:
    source_dir: src/contextcore/contracts/budget
    files:
    - schema.py
    - loader.py
    - validator.py
    - otel.py
    - tracker.py
    test_count: 1
    layer: L6
  description:
    agent: Pydantic v2 models for SLO budget propagation contract format.
- capability_id: contextcore.contract.data_lineage
  category: transform
  maturity: beta
  summary: Transformation history verification and data provenance tracking
  triggers:
  - data lineage
  - provenance
  - transformation history
  - data origin
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/lineage
    files:
    - schema.py
    - loader.py
    - otel.py
    - tracker.py
    test_count: 1
    layer: L7
  description:
    agent: Pydantic v2 models for data lineage contract YAML format.
- capability_id: contextcore.a2a.contract.task_span
  category: transform
  maturity: beta
  summary: Typed contract for task span interchange — validates SpanState v2 compliance, required attributes, and enum values
  triggers:
  - task span contract
  - span validation
  - a2a contract
  - task interchange
  - SpanState validation
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
- capability_id: contextcore.a2a.contract.handoff
  category: transform
  maturity: beta
  summary: Typed contract for agent-to-agent handoff — validates ExpectedOutput, lifecycle status, and provenance chain
  triggers:
  - handoff contract
  - a2a contract
  - delegation validation
  - handoff integrity
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
- capability_id: contextcore.a2a.contract.artifact_intent
  category: transform
  maturity: beta
  summary: Typed declaration of expected artifacts with semantic roles — the Mottainai principle
  triggers:
  - artifact intent
  - a2a contract
  - artifact declaration
  - pipeline output
  - Mottainai
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
- capability_id: contextcore.a2a.contract.gate_result
  category: transform
  maturity: beta
  summary: Typed result from governance gates — pass/fail/warning with structured diagnostics
  triggers:
  - gate result
  - governance gate
  - gate diagnostic
  - integrity check result
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
- capability_id: contextcore.a2a.gate.pipeline_integrity
  category: action
  maturity: beta
  summary: 'Gate 1: 6 structural integrity checks on exported pipeline artifacts'
  triggers:
  - pipeline integrity
  - governance gate
  - a2a-check-pipeline
  - integrity checks
  - export validation
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
  discovery_paths:
  - If you need to validate exported pipeline artifacts before downstream consumption.
  - If you need checksum chain verification and provenance consistency checks.
- capability_id: contextcore.a2a.gate.diagnostic
  category: action
  maturity: beta
  summary: 'Gate 2: Three Questions diagnostic — Was anything lost? Does the shape match? Can we trace the lineage?'
  triggers:
  - diagnostic gate
  - three questions
  - a2a-diagnose
  - governance diagnostic
  - pipeline diagnostic
  confidence: 0.7
  evidence:
    source_dir: src/contextcore/contracts/a2a
    modules:
    - validator.py
    - pilot.py
    - boundary.py
    - models.py
    - three_questions.py
    - gates.py
    - queries.py
    - pipeline_checker.py
- capability_id: contextcore.pipeline.typed_handoff
  category: integration
  maturity: beta
  summary: Use A2A typed primitives (Part, ExpectedOutput) for intra-pipeline stage communication
  description:
    agent: 'Apply A2A communication patterns within a sequential pipeline. Stages declare

      ExpectedOutput contracts. Stage outputs use Part objects (Part.json_data for

      structured fields, Part.text for prose). Gates validate at boundaries using

      ExpectedOutput.fields and completeness_markers.

      '
    human: 'Enables the same typed communication primitives used for agent-to-agent

      handoffs to work within a multi-stage pipeline. Stages declare what they

      will produce (via ExpectedOutput), produce typed output (via Part objects),

      and gates validate at stage boundaries.

      '
  triggers:
  - pipeline communication
  - stage contract
  - intra-pipeline handoff
  - typed stage output
  - stage-to-stage
  delivers_benefit: quality.typed_over_prose
  discovery_paths:
  - If you are building a multi-stage pipeline and need typed contracts between stages, start here.
  - If you need the same typed handoff pattern used in A2A but within a single pipeline.
- capability_id: contextcore.contract.expected_output
  category: transform
  maturity: beta
  summary: Define typed output contracts with required fields, size limits, and completeness markers
  description:
    agent: 'ExpectedOutput defines what a pipeline stage or agent must produce. Fields:

      required_fields (list[str]), max_lines (int), max_tokens (int),

      completeness_markers (list[str]). Used by handoff contracts and pipeline

      gates. Validates output before downstream consumption.

      '
    human: 'A typed contract that specifies what output a stage or agent should produce.

      Instead of hoping output is correct, you declare required fields, size limits,

      and completeness markers upfront. The receiving stage validates the contract

      before consuming the output.

      '
  triggers:
  - output contract
  - expected output
  - required fields
  - completeness markers
  - output schema
  - typed output
  delivers_benefit: quality.prescriptive_over_descriptive
  discovery_paths:
  - If you need to define what output a stage or agent must produce before it runs.
  - If you need size limits, required fields, or completeness markers on generated output.
evidence:
- type: doc
  ref: docs/semantic-conventions.md
  description: Attribute definitions for insight.*, handoff.*, agent.*
- type: doc
  ref: inbox/OTEL_ALIGNED_MATURITY_MODEL.md
  description: Maturity level definitions and transition criteria
risk_flags:
- id: risk:no-retry-on-export-failure
  description: OTel span export failures are not retried—telemetry may be silently lost
  affects:
  - contextcore.insight.emit
  - contextcore.handoff.initiate
- id: risk:k8s-restart-loses-in-flight
  description: Kubernetes pod restarts may lose in-flight handoffs not yet persisted
  affects:
  - contextcore.handoff.initiate
  - contextcore.handoff.receive
pivoted_work:
- id: text-merge-to-ast
  original: Text-based merge_files_intelligently() using diff/patch
  outcome: Corrupted Python files when merging class definitions
  lesson: Text-based merging is insufficient for code; use language-aware tools (AST)
  evidence: src/contextcore/agent/parts.py
- id: single-emit-to-dual
  original: Emit task data to Tempo only (spans are sufficient)
  outcome: Portfolio dashboard couldn't derive metrics from spans alone
  lesson: Different backends excel at different queries; dual-emit to Tempo AND Loki
  evidence: CONTEXTCORE_EMIT_MODE env var
changelog:
- version: 1.10.1
  date: '2026-02-14'
  changes:
  - 'pipeline.check_pipeline: 6 gates → 7 gates (added parameter-resolvability) + --min-coverage threshold enforcement'
  - Updated agent/human descriptions, inputs (min_coverage), evidence description to reflect 7-gate suite
- version: 1.10.0
  date: '2026-02-14'
  changes:
  - 'docs.curate (new, stable): Curate persona-specific documentation catalogs with onboarding/operations classification and
    gap detection'
  - 'Three discovery signals: capability evidence chain (0.9), benefit-to-capability chain (0.7), document type affinity (0.4)'
  - Onboarding vs operations classification based on document type and title heuristics
  - 'Persona-specific gap detection: missing onboarding/operations docs, uncovered critical benefits, role-specific gaps'
  - 'Requirements updated: FR-D-300 series (15 FRs), NFR-D-009 through NFR-D-011, 9 new acceptance criteria'
  - '34 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (9), pipeline (2), docs (4)'
- version: 1.9.0
  date: '2026-02-14'
  changes:
  - 'docs.audit (new, stable): Reverse-engineer capability index to detect documentation gaps with importance scoring'
  - '4-dimension importance model: maturity-confidence (30%), structural complexity (25%), cross-cutting impact (25%), benefit
    linkage (20%)'
  - 8 expected-document rules mapping capability profiles to doc types (R1-R8)
  - 'Cluster consolidation: gaps grouped by namespace, sorted by avg importance, with suggested filenames'
  - 'Requirements updated: FR-D-200 series (14 FRs), NFR-D-006 through NFR-D-008, 8 new acceptance criteria'
  - '33 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (9), pipeline (2), docs (3)'
- version: 1.8.0
  date: '2026-02-14'
  changes:
  - 'docs.index (new, stable): Generate programmatic documentation index from capability evidence + directory scan'
  - 'docs.show (new, stable): Query documentation index with type, capability, freshness, and cross-reference filters'
  - 'New category: DOCUMENTATION INDEX CAPABILITIES'
  - 'New CLI command group: contextcore docs (index, show)'
  - 'New requirements doc: docs/DOCS_INDEX_REQUIREMENTS.md'
  - '32 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (9), pipeline (2), docs (2)'
- version: 1.7.0
  date: '2026-02-14'
  changes:
  - 'manifest.init_bootstrap (new, stable): Scaffold v2 context manifest with template, validation, and pipeline next steps'
  - 'pipeline.check_pipeline (new, stable): 6-gate structural integrity validation for export output (Gate 1)'
  - 'pipeline.diagnose (new, stable): Three Questions diagnostic across export, ingestion, execution layers (Gate 2)'
  - 'New category: PIPELINE GOVERNANCE CAPABILITIES'
  - 'manifest.validate: beta → stable, added CLI flags (--strict, --format), new requirements doc evidence'
  - 'manifest.migrate: Added CLI flags (--in-place, --dry-run, --output), new requirements doc evidence'
  - 'Cross-referenced 3 new requirements docs: MANIFEST_EXPORT_REQUIREMENTS.md, A2A_GATE_REQUIREMENTS.md, MANIFEST_BOOTSTRAP_REQUIREMENTS.md'
  - '30 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (9), pipeline (2)'
- version: 1.6.0
  date: '2026-02-12'
  changes:
  - 'manifest.export_onboarding (new, stable): Programmatic onboarding metadata for plan ingestion and artisan seed enrichment'
  - 'Includes: artifact type schemas, parameter sources, output conventions, example snippets, checksums, task mapping'
  - 'New evidence: docs/EXPORT_PIPELINE_ANALYSIS_GUIDE.md (pipeline analysis guide)'
  - '27 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (8)'
- version: 1.5.0
  date: '2026-02-12'
  changes:
  - 'manifest.export_provenance (new, stable): Export artifact manifest with comprehensive audit trail'
  - 'Provenance captures: git context, source checksum (SHA-256), environment, CLI args, duration'
  - 'New CLI flags: --emit-provenance (separate file), --embed-provenance (in manifest)'
  - 'New files: src/contextcore/utils/provenance.py (150 lines)'
  - 'New models: GitContext, ExportProvenance in artifact_manifest.py'
  - '26 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (7)'
- version: 1.4.0
  date: '2026-02-05'
  changes:
  - 'Context Manifest v2.0 implementation: version-aware loading, migration tooling, CLI commands'
  - 'manifest.load promoted to stable: Auto-detects v1.1 vs v2 from apiVersion'
  - 'manifest.migrate (new, stable): Non-destructive v1.1→v2 transformation with changelog preservation'
  - 'manifest.guidance.read (new, stable): Read agent governance (constraints, focus, questions) from v2'
  - 'New files: manifest_v2.py (475 lines), manifest_loader.py, manifest_migrate.py, cli/manifest.py'
  - 24 tests in test_manifest_v2.py covering v2 models, loader, and migration
  - '25 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (6)'
- version: 1.3.0
  date: '2026-02-05'
  changes:
  - 'Added CONTEXT MANIFEST capabilities (4 new): manifest.load, manifest.distill_crd, manifest.validate, manifest.sync_strategy'
  - 'New category: CONTEXT MANIFEST CAPABILITIES'
  - 'manifest.load: Load and parse Context Manifest (.contextcore.yaml) from file or dict (beta)'
  - 'manifest.distill_crd: Distill lightweight K8s CRD from full manifest (beta)'
  - 'manifest.validate: Validate manifest against Pydantic schema (beta)'
  - 'manifest.sync_strategy: Bidirectional PM tool sync for strategies/tactics (draft)'
  - '23 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5), manifest (4)'
- version: 1.2.0
  date: '2026-01-29'
  changes:
  - 'Phase 4 Unified Alignment: Added 6 new capabilities for A2A interoperability'
  - 'New category: A2A PROTOCOL INTEROPERABILITY'
  - 'a2a.server: Flask/FastAPI server with JSON-RPC 2.0 and .well-known discovery'
  - 'a2a.client: httpx-based client for remote A2A agent communication'
  - 'a2a.task_adapter: Bidirectional A2A Task ↔ Handoff conversion with 9-state mapping'
  - 'a2a.content_model: Unified Part/Message/Artifact with to_a2a_dict() serialization'
  - 'handoff.input_request: InputRequest/InputResponse for mid-handoff clarification'
  - 'api.unified: ContextCoreAPI facade with resource.action naming pattern'
  - 'HandoffStatus expanded: input_required, cancelled, rejected + state machine helpers'
  - '19 total capabilities: insight (2), handoff (3), guidance (2), code_generation (1), size_estimation (1), a2a (4), api
    (1), aos (5)'
- version: 1.1.0
  date: '2026-01-28'
  changes:
  - 'Added AOS compliance capabilities (5 new): aos.message_emit, aos.decision_emit, aos.trigger_emit, aos.mcp_emit, aos.validate'
  - 'New category: AOS COMPLIANCE CAPABILITIES'
  - All AOS capabilities at draft maturity with roadmap metadata
  - 'Capabilities deliver benefit: interop.aos_compliance'
  - '13 total capabilities: insight (2), handoff (2), guidance (2), code_generation (1), size_estimation (1), aos (5)'
- version: 1.0.0
  date: '2026-01-28'
  changes:
  - Initial capability index for agent-focused capabilities
  - '8 capabilities indexed: insight (2), handoff (2), guidance (2), code_generation (1), size_estimation (1)'
  - Evidence verified against source files
  - 'OTel-aligned maturity: stable (2), experimental/beta (6)'
  - Risk flags and pivoted work documented
design_principles:
- id: typed_over_prose
  principle: All inter-agent data exchange uses typed schemas, not natural language parsing
  rationale: 'Structured data eliminates version drift, format ambiguity, and regex fragility.

    ExpectedOutput.fields replaces regex section extraction.

    Part.json_data() replaces string interpolation.

    Time-series databases make structured data queryable over time.

    '
  anti_patterns:
  - Parsing LLM markdown output with regex to extract structured fields
  - Passing strings between pipeline stages instead of typed objects
  - Using document sections as the contract between agents
  applies_to:
  - contextcore.handoff.initiate
  - contextcore.a2a.content_model
  - contextcore.code_generation.contract
- id: prescriptive_over_descriptive
  principle: Declare what should happen and verify it did, rather than recording what happened after the fact
  rationale: 'Traditional observability describes what happened. ContextCore prescribes what

    should happen and verifies that it did. Contracts are the prescriptions.

    This shifts context correctness from runtime hope to design-time guarantee.

    '
  anti_patterns:
  - Relying on post-hoc log analysis to detect context loss
  - Observing failures after they reach production instead of preventing them at design time
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
  - contextcore.contract.semantic_convention
- id: design_time_over_runtime
  principle: Catch context correctness issues when the pipeline is designed, not when it fails in production
  rationale: 'YAML contracts are reviewed in PRs alongside code. Static analysis

    walks the requires/produces graph before any workflow runs.

    '
  anti_patterns:
  - Discovering context propagation failures only in production
  - Testing contract compatibility only during integration testing
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
- id: graceful_degradation
  principle: Not all context fields are equally critical; the severity model (BLOCKING/WARNING/ADVISORY) mirrors real system
    priorities
  rationale: 'Some fields are load-bearing (task list), some are quality-enhancing

    (domain constraints), some are diagnostic aids (debug metadata).

    The severity model enables progressive tightening without all-or-nothing adoption.

    '
  anti_patterns:
  - Treating all context fields as equally critical (fail-fast on everything)
  - Treating all context fields as non-critical (ignore all failures)
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.capability_propagation
  - contextcore.contract.slo_budget
- id: composable_primitives
  principle: 'Every contract layer uses the same four primitives: Declare, Validate, Track, Emit'
  rationale: 'New layers are new contract types plugged into the same framework, not new frameworks.

    The shared primitives ensure consistency across all 7 defense-in-depth layers.

    '
  anti_patterns:
  - Building a custom validation framework for each new contract type
  - Inconsistent checking approaches across different boundary types
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
  - contextcore.contract.causal_ordering
  - contextcore.contract.data_lineage
- id: opt_in_over_mandatory
  principle: Every layer is opt-in; existing systems work unchanged; contracts add verification on top
  rationale: 'Progressive adoption without breaking existing systems. Start with detection,

    add contracts when ready, get prevention for free. Mirrors TypeScript''s adoption

    path — you don''t need strict mode on day one.

    '
  anti_patterns:
  - Requiring all services to adopt contracts simultaneously
  - Breaking existing pipelines when adding contract validation
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
- id: observable_contracts
  principle: The contract system itself emits OTel events, making contract health observable through the same infrastructure
  rationale: 'You can build a dashboard showing ''85% of propagation chains are INTACT,

    10% are DEGRADED, 5% are BROKEN.'' The meta-observability makes the contract

    system trustworthy and queryable via TraceQL.

    '
  anti_patterns:
  - Contract validation that produces only pass/fail with no observability
  - Separate monitoring for contract health vs runtime health
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
  - contextcore.contract.slo_budget
- id: framework_agnostic_contracts
  principle: Contracts declare what must be true about context propagation, not how frameworks achieve it
  rationale: 'ContextCore works with LangGraph, AutoGen, CrewAI, or any runtime. Contracts

    are runtime-independent governance — they validate invariants regardless of

    which framework executes the pipeline.

    '
  anti_patterns:
  - Coupling contract validation to a specific framework's execution model
  - Requiring framework-specific adapters for each contract type
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
  - contextcore.a2a.contract.task_span
  - contextcore.a2a.contract.handoff
- id: governance_metadata_over_runtime
  principle: ContextCore adds governance metadata (contracts, provenance, lineage) on top of whatever runtime metadata the
    framework already produces
  rationale: 'Frameworks like LangGraph emit their own telemetry (graph nodes, edges,

    checkpoints). ContextCore does not duplicate this — it adds governance

    metadata: was the contract satisfied? Was provenance maintained? Did the

    lineage remain intact?

    '
  anti_patterns:
  - Duplicating framework-native telemetry in ContextCore spans
  - Replacing framework telemetry instead of augmenting it
  applies_to:
  - contextcore.contract.propagation
  - contextcore.contract.data_lineage
  - contextcore.a2a.gate.pipeline_integrity
  - contextcore.a2a.gate.diagnostic
patterns:
- pattern_id: typed_handoff
  name: Typed Handoff
  summary: Define output contracts, produce Part-based output, validate at boundary
  capabilities:
  - contextcore.handoff.initiate
  - contextcore.a2a.content_model
  - contextcore.code_generation.contract
  anti_pattern: String-based context propagation with regex parsing
- pattern_id: insight_accumulation
  name: Insight Accumulation
  summary: Emit insights as spans, query accumulated knowledge, compound over time
  capabilities:
  - contextcore.insight.emit
  - contextcore.insight.query
  anti_pattern: Storing knowledge in chat transcripts or session logs
- pattern_id: constraint_gated
  name: Constraint-Gated Execution
  summary: Read constraints before acting, validate compliance, emit decisions
  capabilities:
  - contextcore.guidance.read_constraints
  - contextcore.insight.emit
  anti_pattern: Ignoring governance rules or hardcoding them in prompts
- pattern_id: pipeline_communication
  name: Pipeline Communication
  summary: Stages declare typed contracts, produce Part-based output, gates validate at boundaries
  capabilities:
  - contextcore.handoff.initiate
  - contextcore.a2a.content_model
  anti_pattern: Passing untyped strings between pipeline stages and parsing with regex
- pattern_id: contract_validation
  name: Contract Validation (Defense-in-Depth)
  summary: Declare contracts in YAML, validate at boundaries, track provenance, emit OTel events
  capabilities:
  - contextcore.contract.propagation
  - contextcore.contract.schema_compat
  - contextcore.contract.semantic_convention
  - contextcore.contract.causal_ordering
  - contextcore.contract.capability_propagation
  - contextcore.contract.slo_budget
  - contextcore.contract.data_lineage
  anti_pattern: Propagating context through service boundaries without boundary validation or provenance tracking
- pattern_id: a2a_governance
  name: A2A Governance
  summary: Typed contracts at pipeline export boundaries with integrity gates and diagnostic checks
  capabilities:
  - contextcore.a2a.contract.task_span
  - contextcore.a2a.contract.handoff
  - contextcore.a2a.contract.artifact_intent
  - contextcore.a2a.contract.gate_result
  - contextcore.a2a.gate.pipeline_integrity
  - contextcore.a2a.gate.diagnostic
  anti_pattern: Exporting pipeline artifacts without structural integrity checks or typed contracts
